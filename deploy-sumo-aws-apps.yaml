AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: A CloudFormation template that creates a role for authenticating with Sumoâ€™s AWS integrations.

Metadata:
  
  AWS::CloudFormation::Interface:
    ParameterGroups:
      -
        Label:
          default: "Sumo Logic Deployment Configuration"
        Parameters:
          - SumoDeployment
          - SumoAccessID
          - SumoAccessKey
          - RemoveSumoResourcesOnDeleteStack
          - SumoOrganizationId
      -
        Label:
          default: "Select the Sumo Apps that you want to Deploy:"
        Parameters:
          - InstallGuardDutyApp
          - InstallGuardDutyBenchmarkApp
          - InstallVPCFlowLogsApp
          - InstallWAFApp
          - InstallS3AuditApp
          - InstallSecurityHub
          - InstallThreatIntelForAWS
          - InstallCloudTrailApp
          - InstallConfigApp
          - InstallCISFoundationsApp
          - InstallPCICloudTrailApp
          - InstallPCIVPCFlowLogsApp
          
      -
        Label:
          default: "Sumo Logic GuardDuty Collector/Source/App Configuration"
        Parameters:
          - SourceCategoryName
          
      -   
        Label:
          default: "Sumo Logic Amazon GuardDuty Benchmark Collector/Source/App Configuration"
        Parameters:
          - BenchmarkSourceCategoryName
      -   
        Label:
          default: "Sumo Logic Amazon VPC Flow Logs Collector/Source/App Configuration"
        Parameters:
          - VPCFlowLogsTargetS3BucketName
          - VPCFlowLogsCreateTargetS3Bucket
          - VPCFlowLogsSourceCategoryName
          - VPCFlowLogsPathExpression
          - VPCFlowLogsExcludeRuleName
          - VPCFlowLogsExcludeRule
          
      -   
        Label:
          default: "Sumo Logic Amazon S3 Audit App Collector/Source Configuration"
        Parameters:
          - S3AuditLogsTargetS3BucketName
          - S3AuditCreateTargetS3Bucket
          - S3AuditSourceCategoryName
          - S3AuditPathExpression
      -   
        Label:
          default: "Sumo Logic AWS WAF App Collector/Source Configuration"
        Parameters:
          - KinesisDestinationS3BucketName
          - CreateKinesisDestinationS3Bucket
          - WAFCreateTargetS3Bucket
          - WAFSourceCategoryName
          - WAFPathExpression
          - DeliveryStreamName
          - CompressionFormat
         
      -   
        Label:
          default: "Sumo Logic AWS CloudTrail Collector/Source/App Configuration"
        Parameters:
          - CloudTrailTargetS3BucketName
          - CreateCloudTrailTargetS3Bucket
          - CloudTrailSourceCategoryName
          - CloudTrailPathExpression

      -   
        Label:
          default: "Sumo Logic AWS Config Collector/Source/App Configuration"
        Parameters:
          - ConfigTargetS3BucketName
          - ConfigSourceCategoryName
          - ConfigPathExpression

      -   
        Label:
          default: "Sumo Logic AWS Security Hub App Collector/Source Configuration"
        Parameters:
          - EnableSecurityHub
          - SecurityHubLogsS3BucketName
          - SecurityHubCreateS3Bucket
          - SecurityHubPathExpression
          - SecurityHubConnectionName
          - SecurityHubSourceCategoryName
      
      -   
        Label:
          default: "Sumo Logic Threat Intel For AWS App Collector/Source Configuration"
        Parameters:
          - CloudTrailSourceCategoryName
          - VPCFlowLogsSourceCategoryName
          - ELBSourceCategory 

      -   
        Label:
          default: "Sumo Logic AWS CIS Foundations Benchmark Collector/Source/App Configuration"
        Parameters:
          - CISFoundationsTargetS3BucketName
          - CISFoundationsSourceCategoryName
          - CreateCISFoundationsTargetS3Bucket
          - CISFoundationsPathExpression
      -   
        Label:
          default: "Sumo Logic PCI Compliance for AWS CloudTrail Collector/App Configuration"
        Parameters:
          - PCICloudTrailSourceCategory
          - PCICloudTrailPathExpression
          - PCICloudTrailLogsTargetS3BucketName
          - PCICloudTrailCreateTargetS3Bucket

      -   
        Label:
          default: "Sumo Logic PCI Compliance for Amazon VPC Flow Logs Collector/App Configuration"
        Parameters:
          - PCIVPCSourceCategory
          - PCIVPCPathExpression
          - PCIVPCLogsTargetS3BucketName
          - PCIVPCCreateTargetS3Bucket
          

          
    
    ParameterLabels:
      SumoDeployment:
        default: "Deployment Name"
      SumoAccessID:
        default: "Access ID"
      SumoAccessKey:
        default: "Access Key"
      RemoveSumoResourcesOnDeleteStack:
        default: "Delete SumoLogic Resources when stack is deleted."
      SumoOrganizationId:
        default: "Organization Id"
      InstallGuardDutyApp:
        default: "Install GuardDuty App"
      InstallGuardDutyBenchmarkApp:
        default: "Install GuardDuty Benchmark App"
      InstallVPCFlowLogsApp:
        default: "Install VPC Flow Logs App"
      InstallWAFApp:
        default: "Install WAF App"
      InstallS3AuditApp:
        default: "Install S3Audit App"
      InstallSecurityHub:
        default: "Install SecurityHub App"
      InstallThreatIntelForAWS:
        default: "Install Threat Intel For AWS App"
      InstallPCICloudTrailApp:
        default: "Install PCI compliance for CloudTrail App"
      InstallPCIVPCFlowLogsApp:
        default: "Install PCI compliance for VPC App"
      InstallCloudTrailApp:
        default: "Install CloudTrail App"
      InstallConfigApp:
        default: "Install Config App"
      InstallCISFoundationsApp:
        default: "Install CIS Foundations App"
      CollectorName:
        default: "Collector Name"
      SourceName: 
        default: "Source Name"
      SourceCategoryName:
        default: "Source Category"
      BenchmarkCollectorName:
        default: "Collector Name"
      BenchmarkSourceName:
        default: "Source Name"
      BenchmarkSourceCategoryName:
        default: "Source Category"
      VPCFlowLogsCollectorName:
        default: "Collector Name"
      VPCFlowLogsSourceName:
        default: "Source Name"
      VPCFlowLogsTargetS3BucketName:
        default: "Target S3 Bucket Name"
      VPCFlowLogsCreateTargetS3Bucket:
        default: "Create Target S3 Bucket"
      VPCFlowLogsSourceCategoryName:
        default: "Source Category"
      VPCFlowLogsPathExpression:
        default: "Path Expression"
      VPCFlowLogsExcludeRuleName:
        default: "Exclude Rule Name"
      VPCFlowLogsExcludeRule:
        default: "Exclude Rule"
Parameters:
  InstallGuardDutyApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  SourceCategoryName:
    Type: String
    Default: Labs/AWS/Guardduty
  SumoOrganizationId:
    Type: String
  SumoAccessID:
    Type: String
  SumoAccessKey:
    Type: String
  SumoDeployment:
    Type: String
    AllowedValues:
      - au
      - ca
      - de
      - eu
      - jp
      - us2
      - us1
    Description: "Enter au, ca, de, eu, jp, us2, or us1"
  RemoveSumoResourcesOnDeleteStack:
    AllowedValues:
      - true
      - false
    Default: true
    Description: To delete collector, sources and app when stack is deleted, set this parameter to true. Default is false.
    Type: String

  InstallGuardDutyBenchmarkApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  
  BenchmarkSourceCategoryName:
    Type: String
    Default: Labs/AWS/Guardduty/benchmark

  InstallCloudTrailApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  
  CloudTrailSourceCategoryName:
    Type: String
    Description: Category metadata to use later for querying, e.g. prod/web/apache/access . This data is queried using the '_sourceCategory' key name.
    Default: Labs/cloudtrail
  CloudTrailPathExpression:
    Type: String
    Description: Path expression to match one or more S3 objects. For example, ABC*.log or ABC.log
    Default: "*"
  CloudTrailTargetS3BucketName:
    Type: String
    Default: "quickstart-cloudtrail-logs"
    Description: S3 access logs target buket name.
  CreateCloudTrailTargetS3Bucket:
    Type: String
    Default: "yes"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?"

  InstallConfigApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"

  ConfigSourceCategoryName:
    Type: String
    Default: Labs/AWS/Config
  ConfigTargetS3BucketName:
    Type: String
    Default: "quickstart-config-logs"
    Description: Config logs target buket name.
  ConfigPathExpression:
    Type: String
    Description: Path expression to match one or more S3 objects. For example, ABC*.log or ABC.log
    Default: "*"

  InstallCISFoundationsApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  CISFoundationsSourceCategoryName:
    Type: String
    Description: Category metadata to use later for querying, e.g. prod/web/apache/access . This data is queried using the '_sourceCategory' key name.
    Default: Labs/CIS
  CISFoundationsPathExpression:
    Type: String
    Description: Path expression to match one or more S3 objects. For example, ABC*.log or ABC.log
    Default: "*"
  CISFoundationsTargetS3BucketName:
    Type: String
    Default: "quickstart-cis-logs"
    Description: S3 access logs target buket name.
  CreateCISFoundationsTargetS3Bucket:
    Type: String
    Default: "yes"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?"

  InstallVPCFlowLogsApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  VPCFlowLogsSourceCategoryName:
    Type: String
    Description: Category metadata to use later for querying, e.g. prod/web/apache/access . This data is queried using the '_sourceCategory' key name.
    Default: Labs/vpc
  VPCFlowLogsTargetS3BucketName:
    Type: String
    Default: "quickstart-vpc-logs"
    Description: S3 access logs target buket name.
  VPCFlowLogsCreateTargetS3Bucket:
    Type: String
    Default: "yes"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?"
  VPCFlowLogsPathExpression:
    Type: String
    Description: Path expression to match one or more S3 objects. For example, ABC*.log or ABC.log
    Default: "*"
  VPCFlowLogsExcludeRuleName:
    Type: String
    Default: Exclude VPC File Flow headers
  VPCFlowLogsExcludeRule:
    Type: String
    Description: Exclude rule regexp
    Default: version account-id interface-id srcaddr dstaddr srcport dstport protocol packets bytes start end action log-status
  
  InstallS3AuditApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  
  S3AuditSourceCategoryName:
    Type: String
    Description: Category metadata to use later for querying, e.g. prod/web/apache/access . This data is queried using the '_sourceCategory' key name.
    Default: Labs/s3audit
  S3AuditLogsTargetS3BucketName:
    Type: String
    Default: "quickstart-s3-audit-logs"
    Description: S3 access logs target buket name.
  S3AuditCreateTargetS3Bucket:
    Type: String
    Default: "yes"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?"
  S3AuditPathExpression:
    Type: String
    Description: Path expression to match one or more S3 objects. For example, ABC*.log or ABC.log
    Default: "*"

  InstallWAFApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  
  WAFSourceCategoryName:
    Type: String
    Description: Category metadata to use later for querying, e.g. prod/web/apache/access . This data is queried using the '_sourceCategory' key name.
    Default: "Labs/waf"
   
  KinesisDestinationS3BucketName:
    Type: String
    Default: "quickstart-waf-logs"
    Description: Kinesis destination bucket.
  CreateKinesisDestinationS3Bucket:
    Type: String
    Default: "no"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?"
  WAFPathExpression:
    Type: String
    Description: Path expression to match one or more S3 objects. For example, ABC*.log or ABC.log
    Default: "*"
  DeliveryStreamName:
    Type: String
    Default: waf-kinesis-delivery-stream-quickstart
    Description: "Name of the delivery stream."
  
  InstallSecurityHub:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  EnableSecurityHub:
    Type: String
    Default: "no"
    AllowedValues: ["yes", "no"]
  
  ConnectionName:
    Type: String
    Default: security-hub-webhook-connection
  SecurityHubSourceCategoryName:
    Type: String
    Description: Category metadata to use later for querying, e.g. prod/web/apache/access . This data is queried using the '_sourceCategory' key name.
    Default: Labs/hub
 
  SecurityHubPathExpression:
    Type: String
    Default: "*"
  
  SecurityHubLogsS3BucketName:
    Type: String
    Default: "quickstart-hub-logs"
    Description: Security Hub Collector destination bucket.
  SecurityHubCreateS3Bucket:
    Type: String
    Default: "yes"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?" 

  InstallThreatIntelForAWS:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  ELBSourceCategory:
    Type: String
    Default: "/AWS/ELB"

  InstallPCICloudTrailApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  PCICloudTrailSourceCategory:
    Type: String
    Default: "Labs/pci/cloudtrail"
  PCICloudTrailPathExpression:
    Type: String
    Default: "*"
  PCICloudTrailLogsTargetS3BucketName:
    Type: String
    Default: "quickstart-pci-cloud-logs"
  PCICloudTrailCreateTargetS3Bucket:
    Type: String
    Default: "yes"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?"

  InstallPCIVPCFlowLogsApp:
    Type: String
    Default: "yes"
    AllowedValues:
      - "yes"
      - "no"
  PCIVPCSourceCategory:
    Type: String
    Default: "Labs/pci/vpc"
  PCIVPCPathExpression:
    Type: String
    Default: "*"
  PCIVPCLogsTargetS3BucketName:
    Type: String
    Default: "quickstart-pci-vpc-logs"
  PCIVPCCreateTargetS3Bucket:
    Type: String
    Default: "yes"
    AllowedValues: ["yes", "no"]
    Description: "Do you want to create a target S3 bucket?"

  
Conditions:
  InstallGuardDutyCondition: !Equals [ !Ref InstallGuardDutyApp, "yes" ]
  InstallGuardDutyBenchmarkCondition: !Equals [ !Ref InstallGuardDutyBenchmarkApp, "yes" ]
  InstallCloudTrailCondition: !Equals [ !Ref InstallCloudTrailApp, "yes" ]
  InstallConfigCondition: !Equals [ !Ref InstallConfigApp, "yes" ]
  InstallCISFoundationsCondition: !Equals [ !Ref InstallCISFoundationsApp, "yes" ]
  InstallVPCFlowLogsCondition: !Equals [ !Ref InstallVPCFlowLogsApp, "yes" ]
  InstallS3AuditCondition: !Equals [ !Ref InstallS3AuditApp, "yes" ]
  InstallWAFCondition: !Equals [ !Ref InstallWAFApp, "yes" ]
  InstallSecurityHubCondition: !Equals [ !Ref InstallSecurityHub, "yes" ]
  InstallThreatIntelCondition: !Equals [ !Ref InstallThreatIntelForAWS, "yes" ]
  InstallPCICloudTrailCondition: !Equals [ !Ref InstallPCICloudTrailApp, "yes" ]
  InstallPCIVPCFlowLogsCondition: !Equals [ !Ref InstallPCIVPCFlowLogsApp, "yes" ]

Resources:
  sumoWAF:
    Condition: InstallWAFCondition
    Type: AWS::Serverless::Application
    Properties:
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:956882708938:applications/sumologic-amazon-waf
        SemanticVersion: 0.0.1
      Parameters:
        CollectorName: "QuickStart-AWSWAF"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref WAFSourceCategoryName
        SourceName: "AWSWAF"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        KinesisDestinationS3BucketName: !Ref KinesisDestinationS3BucketName
        CreateKinesisDestinationS3Bucket: !Ref CreateKinesisDestinationS3Bucket
        PathExpression: !Ref WAFPathExpression
        SumoDeployment: !Ref SumoDeployment
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"
        DeliveryStreamName: !Ref DeliveryStreamName

  sumoVPCFlowLogs:
    Condition: InstallVPCFlowLogsCondition
    Type: AWS::Serverless::Application
    Properties:
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:956882708938:applications/sumologic-amazon-vpc-flow-logs
        SemanticVersion: 0.0.1
      Parameters: 
        CollectorName: "QuickStart-AmazonVPCFlowLogs"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref VPCFlowLogsSourceCategoryName
        SourceName: "AmazonVPCFlowLogs"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        LogsTargetS3BucketName: !Ref VPCFlowLogsTargetS3BucketName
        VPCFlowLogAppSourceCategoryName: !Ref VPCFlowLogsSourceCategoryName
        CreateTargetS3Bucket: !Ref VPCFlowLogsCreateTargetS3Bucket
        PathExpression: !Ref VPCFlowLogsPathExpression
        SumoDeployment: !Ref SumoDeployment
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"

  sumoguardduty:
    Condition: InstallGuardDutyCondition
    Type: AWS::Serverless::Application
    Properties:
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:956882708938:applications/sumologic-amazon-guardduty
        SemanticVersion: 0.0.1
      Parameters: 
        CollectorName: "QuickStart-AmazonGuardDuty"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref SourceCategoryName
        SourceName: "AmazonGuardDuty"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        SumoDeployment: !Ref SumoDeployment

  sumoguarddutybenchmark:
    Condition: InstallGuardDutyBenchmarkCondition
    Type: AWS::Serverless::Application
    Properties:
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:956882708938:applications/sumologic-amazon-guardduty-benchmark
        SemanticVersion: 0.0.1
      Parameters: 
        CollectorName: "QuickStart-AmazonGuardDutyBenchmark"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref BenchmarkSourceCategoryName
        SourceName: "AmazonGuardDutyBenchmark"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        SumoDeployment: !Ref SumoDeployment  
  
  sumocloudtrail: 
    Condition: InstallCloudTrailCondition
    Type: AWS::CloudFormation::Stack
    Properties: 
      TemplateURL: "https://sumologic-appdev-aws-sam-apps.s3.amazonaws.com/cloudtrail-template-2019-11-06-23-48-48.yaml"
      Parameters: 
        CollectorName: "QuickStart-AWSCloudTrail"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref CloudTrailSourceCategoryName
        SourceName: "AWSCloudTrail"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        SumoDeployment: !Ref SumoDeployment
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"
        PathExpression: !Ref CloudTrailPathExpression
        CloudTrailTargetS3BucketName: !Ref CloudTrailTargetS3BucketName   
        CreateTargetS3Bucket: !Ref CreateCloudTrailTargetS3Bucket
    
  sumoconfig:
    Condition: InstallConfigCondition
    Type: AWS::Serverless::Application
    Properties:
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:956882708938:applications/sumologic-amazon-config
        SemanticVersion: 0.0.1
      Parameters: 
        CollectorName: "QuickStart-AWSConfig"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref ConfigSourceCategoryName
        SourceName: "AWSConfig"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        SumoDeployment: !Ref SumoDeployment
        ConfigTargetS3BucketName: !Ref ConfigTargetS3BucketName
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"
        PathExpression: !Ref ConfigPathExpression
    
  sumocisfoundations:
    Condition: InstallCISFoundationsCondition
    Type: AWS::CloudFormation::Stack
    Properties: 
      TemplateURL: "https://sumologic-appdev-aws-sam-apps.s3.amazonaws.com/CIS-Foundations-template-2019-11-06-23-50-12.yaml"
      Parameters: 
        CollectorName: "QuickStart-CISAWSFoundationsBenchmark"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref CISFoundationsSourceCategoryName
        SourceName: "CISAWSFoundationsBenchmark"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        SumoDeployment: !Ref SumoDeployment
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"
        PathExpression: !Ref CISFoundationsPathExpression
        CISTargetS3BucketName: !Ref CISFoundationsTargetS3BucketName 
        CreateTargetS3Bucket: !Ref CreateCISFoundationsTargetS3Bucket

  sumoS3Audit:
    Condition: InstallS3AuditCondition
    Type: AWS::Serverless::Application
    Properties:
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:956882708938:applications/sumologic-amazon-s3-audit
        SemanticVersion: 0.0.1
      Parameters: 
        CollectorName: "QuickStart-AmazonS3Audit"
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        SourceCategoryName: !Ref S3AuditSourceCategoryName
        SourceName: "AmazonS3Audit"
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        AccessLogsTargetS3BucketName: !Ref S3AuditLogsTargetS3BucketName
        CreateTargetS3Bucket: !Ref S3AuditCreateTargetS3Bucket
        PathExpression: !Ref S3AuditPathExpression
        SumoDeployment: !Ref SumoDeployment
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"

  sumoSecurityHubStack:
    Type: AWS::CloudFormation::Stack
    Condition: InstallSecurityHubCondition
    Properties:
      TemplateURL: "https://sumologic-appdev-aws-sam-apps.s3.amazonaws.com/security-hub-template-2019-11-06-23-52-25.yaml"
      Parameters:
        SumoDeployment: !Ref SumoDeployment
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        EnableSecurityHub: !Ref EnableSecurityHub
        CollectorName: "QuickStart-AWSSecurityHub"
        ConnectionName: !Ref ConnectionName
        S3BucketName: !Ref SecurityHubLogsS3BucketName
        CreateTargetS3Bucket: !Ref SecurityHubCreateS3Bucket
        SourceCategoryName: !Ref SecurityHubSourceCategoryName
        SourceName: "AWSSecurityHub"
        PathExpression: !Ref SecurityHubPathExpression
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"

  sumoThreatIntelForAWS:
    Condition: InstallThreatIntelCondition
    Type: AWS::Serverless::Application
    Properties:
      Location:
        ApplicationId: arn:aws:serverlessrepo:us-east-1:956882708938:applications/sumologic-amazon-threat-intel
        SemanticVersion: 0.0.1
      Parameters:
        CloudTrailSourceCategory: !Ref CloudTrailSourceCategoryName
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        VPCSourceCategory: !Ref VPCFlowLogsSourceCategoryName
        ELBSourceCategory: !Ref ELBSourceCategory
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        SumoDeployment: !Ref SumoDeployment
  
  sumoPCICloudTrailStack:
    Type: AWS::CloudFormation::Stack
    Condition: InstallPCICloudTrailCondition
    Properties:
      TemplateURL: "https://sumologic-appdev-aws-sam-apps.s3.amazonaws.com/pci-compliance-cloudttrial-app-template-2019-11-06-23-54-50.yaml"
      Parameters:
        S3SourceUtilTempalteS3Url: "https://sumologic-appdev-aws-sam-apps.s3.amazonaws.com/sumo-s3-source-utils-2019-11-06-23-54-35.yaml"
        SumoDeployment: !Ref SumoDeployment
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        CollectorName: "QuickStart-PCIComplianceforAWSCloudTrailApp"
        SourceCategory: !Ref PCICloudTrailSourceCategory
        LogsTargetS3BucketName: !Ref PCICloudTrailLogsTargetS3BucketName
        CreateTargetS3Bucket: !Ref PCICloudTrailCreateTargetS3Bucket
        SourceName: "PCIComplianceforAWSCloudTrailApp"
        PathExpression: !Ref PCICloudTrailPathExpression
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"
        PCICloudTrailAppSourceCategory: !Ref PCICloudTrailSourceCategory
  
  sumoPCIVPCFlowLogsStack:
    Type: AWS::CloudFormation::Stack
    Condition: InstallPCIVPCFlowLogsCondition
    Properties:
      TemplateURL: "https://sumologic-appdev-aws-sam-apps.s3.amazonaws.com/pci-compliance-vpc-flow-template-2019-11-06-23-53-47.yaml"
      Parameters:
        S3SourceUtilTempalteS3Url: "https://sumologic-appdev-aws-sam-apps.s3.amazonaws.com/sumo-s3-source-utils-2019-11-06-23-53-29.yaml"
        SumoDeployment: !Ref SumoDeployment
        SumoAccessID: !Ref SumoAccessID
        SumoAccessKey: !Ref SumoAccessKey
        RemoveSumoResourcesOnDeleteStack: !Ref RemoveSumoResourcesOnDeleteStack
        CollectorName: "QuickStart-PCIComplianceforAmazonVPCFlowLogs"
        LogsTargetS3BucketName: !Ref PCIVPCLogsTargetS3BucketName
        CreateTargetS3Bucket: !Ref PCIVPCCreateTargetS3Bucket
        PCIVpcFlowAppSourceCategory: !Ref PCIVPCSourceCategory
        SourceName: "PCIComplianceforAmazonVPCFlowLogs"
        PathExpression: !Ref PCIVPCPathExpression
        ExternalID: !Sub "${SumoDeployment}:${SumoOrganizationId}"
        SourceCategory: !Ref PCIVPCSourceCategory


        

  
  
  
  
  
  
  
  

